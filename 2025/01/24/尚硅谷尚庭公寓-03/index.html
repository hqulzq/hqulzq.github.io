<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hqulzq.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="尚硅谷尚庭公寓-03ThreadLocal介绍ThreadLocal是JDK提供的一个线程内部的数据存储工具类，它提供了一些方法，用于在当前线程中存储数据，并且每个线程都可以独立地访问自己的数据。">
<meta property="og:type" content="article">
<meta property="og:title" content="尚硅谷尚庭公寓-03">
<meta property="og:url" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/index.html">
<meta property="og:site_name" content="Lzq&#39;s blog">
<meta property="og:description" content="尚硅谷尚庭公寓-03ThreadLocal介绍ThreadLocal是JDK提供的一个线程内部的数据存储工具类，它提供了一些方法，用于在当前线程中存储数据，并且每个线程都可以独立地访问自己的数据。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/thread.png">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/mybatis-%E4%B8%80%E5%AF%B9%E5%A4%9A.drawio.svg">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/mybatis-%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84.drawio.svg">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/mybatis-%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2.drawio.svg">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/mybatis-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2-%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84.drawio.svg">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/mybatis-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2-%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2.drawio.svg">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/%E7%BC%93%E5%AD%98%E6%A6%82%E8%BF%B0.drawio.svg">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/%E7%BC%93%E5%AD%98%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A.png">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E6%B5%8B%E8%AF%95.png">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/AccessKey%E7%AE%A1%E7%90%86.png">
<meta property="og:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/images/%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E5%9B%BE-%E8%AF%A6%E7%BB%86.drawio.png">
<meta property="article:published_time" content="2025-01-24T03:24:51.000Z">
<meta property="article:modified_time" content="2025-01-25T10:26:09.488Z">
<meta property="article:author" content="Zongqing Li">
<meta property="article:tag" content="尚庭公寓">
<meta property="article:tag" content="项目实战">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/thread.png">

<link rel="canonical" href="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>尚硅谷尚庭公寓-03 | Lzq's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lzq's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">31</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">12</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">43</span></a>

  </li>
        <li class="menu-item menu-item-book">

    <a href="/book" rel="section"><i class="fas fa-book fa-fw"></i>Book</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hqulzq.github.io/2025/01/24/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://github.com/hqulzq/hqulzq.github.io/blob/main/images/head.png?raw=true">
      <meta itemprop="name" content="Zongqing Li">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lzq's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          尚硅谷尚庭公寓-03
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-24 11:24:51" itemprop="dateCreated datePublished" datetime="2025-01-24T11:24:51+08:00">2025-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-25 18:26:09" itemprop="dateModified" datetime="2025-01-25T18:26:09+08:00">2025-01-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="尚硅谷尚庭公寓-03"><a href="#尚硅谷尚庭公寓-03" class="headerlink" title="尚硅谷尚庭公寓-03"></a>尚硅谷尚庭公寓-03</h1><h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>ThreadLocal是JDK提供的一个线程内部的数据存储工具类，它提供了一些方法，用于在当前线程中存储数据，并且每个线程都可以独立地访问自己的数据。<br><img src="thread.png" style="zoom: 33%;" /><br><span id="more"></span></p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><ul>
<li><p>理论上我们可以在Controller方法中，使用<code>@RequestHeader</code>获取JWT，然后在进行解析，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取登陆用户个人信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SystemUserInfoVo&gt; <span class="title function_">info</span><span class="params">(<span class="meta">@RequestHeader(&quot;access-token&quot;)</span> String token)</span> &#123;</span><br><span class="line">    <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseToken(token);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> claims.get(<span class="string">&quot;userId&quot;</span>, Long.class);</span><br><span class="line">    <span class="type">SystemUserInfoVo</span> <span class="variable">userInfo</span> <span class="operator">=</span> service.getLoginUserInfo(userId);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(userInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码的逻辑没有任何问题，但是这样做，JWT会被重复解析两次（一次在拦截器中，一次在该方法中）。为避免重复解析，通常会在拦截器将Token解析完毕后，将结果保存至<strong>ThreadLocal</strong>中，这样一来，我们便可以在整个请求的处理流程中进行访问了。</p>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.login.LoginUserHolder</code>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;LoginUser&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setLoginUser</span><span class="params">(LoginUser loginUser)</span> &#123;</span><br><span class="line">        threadLocal.set(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.login.LoginUser</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改<code>AuthenticationInterceptor</code>拦截器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;access-token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseToken(token);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> claims.get(<span class="string">&quot;userId&quot;</span>, Long.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> claims.get(<span class="string">&quot;username&quot;</span>, String.class);</span><br><span class="line">        LoginUserHolder.setLoginUser(<span class="keyword">new</span> <span class="title class_">LoginUser</span>(userId, username));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        LoginUserHolder.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Operation(summary = &quot;获取登陆用户个人信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SystemUserInfoVo&gt; <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SystemUserInfoVo</span> <span class="variable">userInfo</span> <span class="operator">=</span> service.getLoginUserInfo(LoginUserHolder.getLoginUser().getUserId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(userInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<p>在<code>LoginService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SystemUserInfoVo <span class="title function_">getLoginUserInfo</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">    <span class="type">SystemUser</span> <span class="variable">systemUser</span> <span class="operator">=</span> systemUserMapper.selectById(userId);</span><br><span class="line">    <span class="type">SystemUserInfoVo</span> <span class="variable">systemUserInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemUserInfoVo</span>();</span><br><span class="line">    systemUserInfoVo.setName(systemUser.getName());</span><br><span class="line">    systemUserInfoVo.setAvatarUrl(systemUser.getAvatarUrl());</span><br><span class="line">    <span class="keyword">return</span> systemUserInfoVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="xml文件-lt-和-gt-的转义"><a href="#xml文件-lt-和-gt-的转义" class="headerlink" title="xml文件&lt;和&gt;的转义"></a><strong>xml文件<code>&lt;</code>和<code>&gt;</code>的转义</strong></h2><p>由于xml文件中的<code>&lt;</code>和<code>&gt;</code>是特殊符号，需要转义处理。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>原符号</th>
<th>转义符号</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;</code></td>
<td><code>&amp;lt;</code></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td><code>&amp;gt;</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="Mybatis-Plus分页插件注意事项"><a href="#Mybatis-Plus分页插件注意事项" class="headerlink" title="Mybatis-Plus分页插件注意事项"></a><strong>Mybatis-Plus分页插件注意事项</strong></h2><p>使用Mybatis-Plus的分页插件进行分页查询时，如果结果需要使用<code>&lt;collection&gt;</code>进行映射，只能使用<strong><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3sqlmap-xml.html#nested-select-for-collection">嵌套查询（Nested Select for Collection）</a></strong>，而不能使用<strong><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xmlhtml#nested-results-for-collection">嵌套结果映射（Nested Results for Collection）</a></strong>。<br><strong>嵌套查询</strong>和<strong>嵌套结果映射</strong>是Collection映射的两种方式，下面通过一个案例进行介绍<br>例如有<code>room_info</code>和<code>graph_info</code>两张表，其关系为一对多，如下<br><img src="mybatis-一对多.drawio.svg" style="zoom:50%;" /><br>现需要查询房间列表及其图片信息，期望返回的结果如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">201</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rent&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;graphList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">202</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rent&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;graphList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>  为得到上述结果，可使用以下两种方式</p>
<ul>
<li><p><strong>嵌套结果映射</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRoomPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;RoomPageMap&quot;</span>&gt;</span></span><br><span class="line">    select ri.id room_id,</span><br><span class="line">           ri.number,</span><br><span class="line">           ri.rent,</span><br><span class="line">        gi.id graph_id,</span><br><span class="line">           gi.url,</span><br><span class="line">           gi.room_id</span><br><span class="line">    from room_info ri</span><br><span class="line">    left join graph_info gi on ri.id=gi.room_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;RoomPageMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;RoomInfoVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;room_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;graphInfoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;GraphInfo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;graph_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  这种方式的执行原理如下图所示</p>
<p>  <img src="mybatis-嵌套结果映射.drawio.svg" style="zoom:50%;" /></p>
</li>
<li><p><strong>嵌套查询</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRoomPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;RoomPageMap&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           number,</span><br><span class="line">           rent</span><br><span class="line">    from room_info</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;RoomPageMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;RoomInfoVo&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;graphInfoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;GraphInfo&quot;</span> <span class="attr">select</span>=<span class="string">&quot;selectGraphByRoomId&quot;</span>       <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectGraphByRoomId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;GraphInfo&quot;</span>&gt;</span></span><br><span class="line">    select id,</span><br><span class="line">           url,</span><br><span class="line">        room_id</span><br><span class="line">    from graph_info</span><br><span class="line">    where room_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  这种方法使用两个独立的查询语句来获取一对多关系的数据。首先，Mybatis会执行主查询来获取<code>room_info</code>列表，然后对于每个<code>room_info</code>，Mybatis都会执行一次子查询来获取其对应的<code>graph_info</code>。</p>
<p>  <img src="mybatis-嵌套查询.drawio.svg" style="zoom:50%;" /></p>
<p>若现在使用MybatisPlus的分页插件进行分页查询，假如查询的内容是第<strong>1</strong>页，每页<strong>2</strong>条记录，则上述两种方式的查询结果分别是</p>
</li>
<li><p><strong>嵌套结果映射</strong></p>
<p>  <img src="mybatis-分页查询-嵌套结果映射.drawio.svg" style="zoom:50%;" /></p>
</li>
<li><p><strong>嵌套查询</strong></p>
<p>  <img src="mybatis-分页查询-嵌套查询.drawio.svg" style="zoom:50%;" /></p>
<p>显然<strong>嵌套结果映射</strong>的分页逻辑是存在问题的。</p>
</li>
</ul>
<h2 id="异步操作"><a href="#异步操作" class="headerlink" title="异步操作"></a>异步操作</h2><ul>
<li><p>保存浏览历史的动作不应影响前端获取房间详情信息，故此处采取异步操作。Spring Boot提供了<code>@Async</code>注解来完成异步操作，具体使用方式为：</p>
<ul>
<li><p>启用Spring Boot异步操作支持<br>  在 Spring Boot 主应用程序类上添加 <code>@EnableAsync</code> 注解，如下</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppWebApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AppWebApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在要进行异步处理的方法上添加 <code>@Async</code> 注解，如下</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveHistory</span><span class="params">(Long userId, Long roomId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;BrowsingHistory&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(BrowsingHistory::getUserId, userId);</span><br><span class="line">    queryWrapper.eq(BrowsingHistory::getRoomId, roomId);</span><br><span class="line">    <span class="type">BrowsingHistory</span> <span class="variable">browsingHistory</span> <span class="operator">=</span> browsingHistoryMapper.selectOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (browsingHistory != <span class="literal">null</span>) &#123;</span><br><span class="line">        browsingHistory.setBrowseTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        browsingHistoryMapper.updateById(browsingHistory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">BrowsingHistory</span> <span class="variable">newBrowsingHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrowsingHistory</span>();</span><br><span class="line">        newBrowsingHistory.setUserId(userId);</span><br><span class="line">        newBrowsingHistory.setRoomId(roomId);</span><br><span class="line">        newBrowsingHistory.setBrowseTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        browsingHistoryMapper.insert(newBrowsingHistory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>缓存优化是一个性价比很高的优化手段，多数情况下，缓存优化可以通过一些简单的操作，换来性能的大幅提升。缓存优化的核心思想就是将一些原本保存在磁盘（例如MySQL）中的、经常访问并且查询开销比较大的数据，临时保存到内存（例如Redis）中。后序再访问相同数据时，就可直接从内存中获取结果，而无需再访问磁盘，由于内存的读写速度远高于磁盘，因此就能极大的提高程序的性能。</p>
<p><img src="缓存概述.drawio.svg" style="zoom:50%;" /></p>
<p>在使用缓存优化时，有一个问题不得不提，那就是<strong>数据库和缓存数据的一致性</strong>，当数据库中的数据发生变化时，缓存中的数据也要同步更新，否则就会出现数据不一致的问题，解决该问题的方案有如下几个</p>
<ul>
<li>数据发生变化时，更新数据库的同时也更新缓存</li>
<li>数据发生变化时，更新数据库的同时删除缓存</li>
</ul>
<p>在了解了缓存优化的核心思想后，我们以移动端中的<code>根据ID获取房间详情</code>接口为例，进行缓存优化。该接口涉及多表查询，查询时会多次访问数据库，查询代价较高，故可采取缓存优化，加快查询速度。</p>
<h3 id="编写缓存逻辑"><a href="#编写缓存逻辑" class="headerlink" title="编写缓存逻辑"></a>编写缓存逻辑</h3><p><strong>1.自定义RedisTemplate</strong></p>
<p>本项目使用Reids保存缓存数据，因此我们需要使用RedisTemplate进行读写操作。前文提到过，<code>Spring-data-redis</code>提供了<code>StringRedisTemplate</code>和<code>RedisTemplate&lt;Object,Object&gt;</code>两个实例，但是两个实例均不满足我们当前的需求，所以我们需要自定义RedisTemplate。</p>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.redis.RedisConfiguration</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">stringObjectRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setValueSerializer(RedisSerializer.java());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2.编写缓存逻辑</strong></p>
<p>修改<strong>web-app模块</strong>中的<code>com.atguigu.lease.web.app.service.impl.RoomInfoServiceImpl</code>中的<code>getDetailById</code>方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> RoomDetailVo <span class="title function_">getDetailById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstant.APP_ROOM_PREFIX + id;</span><br><span class="line">    <span class="type">RoomDetailVo</span> <span class="variable">roomDetailVo</span> <span class="operator">=</span> (RoomDetailVo) redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (roomDetailVo == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//1.查询房间信息</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.查询图片</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.查询租期</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.查询配套</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.查询标签</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.查询支付方式</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.查询基本属性</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//8.查询杂费信息</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9.查询公寓信息</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        roomDetailVo = <span class="keyword">new</span> <span class="title class_">RoomDetailVo</span>();</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(key, roomDetailVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//10.保存浏览历史</span></span><br><span class="line">    browsingHistoryService.saveHistory(LoginUserHolder.getLoginUser().getUserId(), id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> roomDetailVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.编写删除缓存逻辑</strong></p>
<p>为保证缓存数据的一致性，在房间信息发生变化时，需要删除相关缓存。<br>修改<strong>web-admin模块</strong>中的<code>com.atguigu.lease.web.admin.service.impl.RoomInfoServiceImpl</code>中的<code>saveOrUpdateRoom</code>方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdateRoom</span><span class="params">(RoomSubmitVo roomSubmitVo)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isUpdate</span> <span class="operator">=</span> roomSubmitVo.getId() != <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">super</span>.saveOrUpdate(roomSubmitVo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//若为更新操作，则先删除与Room相关的各项信息列表</span></span><br><span class="line">    <span class="keyword">if</span> (isUpdate) &#123;</span><br><span class="line">        <span class="comment">//1.删除原有graphInfoList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.删除原有roomAttrValueList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.删除原有roomFacilityList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.删除原有roomLabelList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.删除原有paymentTypeList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.删除原有leaseTermList</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.删除缓存</span></span><br><span class="line">        redisTemplate.delete(RedisConstant.APP_LOGIN_PREFIX + roomSubmitVo.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.保存新的graphInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.保存新的roomAttrValueList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.保存新的facilityInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.保存新的labelInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.保存新的paymentTypeList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.保存新的leaseTermList</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改<strong>web-admin模块</strong>中的<code>com.atguigu.lease.web.admin.service.impl.RoomInfoServiceImpl</code>中的<code>removeRoomById</code>方法，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeRoomById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.删除RoomInfo</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除graphInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.删除attrValueList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.删除facilityInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.删除labelInfoList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.删除paymentTypeList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.删除leaseTermList</span></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8.删除缓存</span></span><br><span class="line">    redisTemplate.delete(RedisConstant.APP_ROOM_PREFIX + id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h3><p>可使用Postman或者Apifox等工具对<code>根据ID获取房间详情</code>这个接口进行压力测试，下图是增加缓存前后的测试报告</p>
<p><img src="缓存压力测试报告.png" style="border:solid 1px" /></p>
<h2 id="阿里云短信"><a href="#阿里云短信" class="headerlink" title="阿里云短信"></a>阿里云短信</h2><h3 id="获取短信验证码"><a href="#获取短信验证码" class="headerlink" title="获取短信验证码"></a>获取短信验证码</h3><p>该接口需向登录手机号码发送短信验证码，各大云服务厂商都提供短信服务，本项目使用阿里云完成短信验证码功能，下面介绍具体配置。</p>
<ul>
<li><p><strong>配置短信服务</strong></p>
<ul>
<li><p><strong>开通短信服务</strong></p>
<ul>
<li><p>在<a target="_blank" rel="noopener" href="https://www.aliyun.com">阿里云官网</a>，注册阿里云账号，并按照指引，完成实名认证（不认证，无法购买服务）</p>
</li>
<li><p>找到<a target="_blank" rel="noopener" href="https://www.aliyun.com/product/sms">短信服务</a>，选择<strong>免费开通</strong></p>
</li>
<li><p>进入<a target="_blank" rel="noopener" href="https://dysms.console.aliyun.com/overview">短信服务控制台</a>，选择<strong>快速学习和测试</strong></p>
</li>
<li><p>找到<strong>发送测试</strong>下的<strong>API发送测试</strong>，绑定测试用的手机号（只有绑定的手机号码才能收到测试短信），然后配置短信签名和短信模版，这里选择<strong>[专用]测试签名/模版</strong>。</p>
<p><img src="短信服务测试.png" alt=""></p>
</li>
</ul>
</li>
<li><p><strong>创建AccessKey</strong></p>
<p>云账号 AccessKey 是访问阿里云 API 的密钥，没有AccessKey无法调用短信服务。点击页面右上角的头像，选择<strong>AccessKey管理</strong>，然后<strong>创建AccessKey</strong>。</p>
<p><img src="AccessKey管理.png" alt="image-20230808104345383" style="zoom: 45%;" /></p>
</li>
</ul>
</li>
<li><p><strong>配置所需依赖</strong></p>
<p>如需调用阿里云的短信服务，需使用其提供的SDK，具体可参考<a target="_blank" rel="noopener" href="https://next.api.aliyun.com/api-tools/sdk/Dysmsapi?spm=a2c4g.215759.0.0.43e6807dDRAZVz&amp;version=2017-05-25&amp;language=java-tea&amp;tab=primer-doc#doc-summary">官方文档</a>。</p>
<p>在<strong>common模块</strong>的pom.xml文件中增加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dysmsapi20170525<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置发送短信客户端</strong></p>
<ul>
<li><p>在<code>application.yml</code>中增加如下内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">sms:</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">&lt;access-key-id&gt;</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">&lt;access-key-secret&gt;</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">dysmsapi.aliyuncs.com</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>上述<code>access-key-id</code>、<code>access-key-secret</code>需根据实际情况进行修改。</p>
</li>
<li><p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.sms.AliyunSMSProperties</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;aliyun.sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunSMSProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.sms.AliyunSmsConfiguration</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(AliyunSMSProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;aliyun.sms.endpoint&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunSMSConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliyunSMSProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Client <span class="title function_">smsClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.setAccessKeyId(properties.getAccessKeyId());</span><br><span class="line">        config.setAccessKeySecret(properties.getAccessKeySecret());</span><br><span class="line">        config.setEndpoint(properties.getEndpoint());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Client</span>(config);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>配置Redis连接参数</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.101</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Controller层逻辑</strong></p>
<p>在<code>LoginController</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;login/getCode&quot;)</span></span><br><span class="line"><span class="meta">@Operation(summary = &quot;获取短信验证码&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getCode</span><span class="params">(<span class="meta">@RequestParam</span> String phone)</span> &#123;</span><br><span class="line">    service.getSMSCode(phone);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写Service层逻辑</strong></p>
<ul>
<li><p>编写发送短信逻辑</p>
<ul>
<li><p>在<code>SmsService</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">sendCode</span><span class="params">(String phone, String verifyCode)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>SmsServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCode</span><span class="params">(String phone, String code)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">SendSmsRequest</span> <span class="variable">smsRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">    smsRequest.setPhoneNumbers(phone);</span><br><span class="line">    smsRequest.setSignName(<span class="string">&quot;阿里云短信测试&quot;</span>);</span><br><span class="line">    smsRequest.setTemplateCode(<span class="string">&quot;SMS_154950909&quot;</span>);</span><br><span class="line">    smsRequest.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span> + code + <span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        client.sendSms(smsRequest);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>编写生成随机验证码逻辑</p>
<p>在<strong>common模块</strong>中创建<code>com.atguigu.lease.common.utils.VerifyCodeUtil</code>类，内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCodeUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getVerifyCode</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            builder.append(random.nextInt(<span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写获取短信验证码逻辑</p>
<ul>
<li><p>在<code>LoginServcie</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">getSMSCode</span><span class="params">(String phone)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>LoginServiceImpl</code>中增加如下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getSMSCode</span><span class="params">(String phone)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 检查手机号码是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(phone)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_LOGIN_PHONE_EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 检查Redis中是否已经存在该手机号码的key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstant.APP_LOGIN_PREFIX + phone;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">hasKey</span> <span class="operator">=</span> redisTemplate.hasKey(key);</span><br><span class="line">    <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line">        <span class="comment">//若存在，则检查其存在的时间</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">expire</span> <span class="operator">=</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (RedisConstant.APP_LOGIN_CODE_TTL_SEC - expire &lt; RedisConstant.APP_LOGIN_CODE_RESEND_TIME_SEC) &#123;</span><br><span class="line">            <span class="comment">//若存在时间不足一分钟，响应发送过于频繁</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LeaseException</span>(ResultCodeEnum.APP_SEND_SMS_TOO_OFTEN);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.发送短信，并将验证码存入Redis</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> VerifyCodeUtil.getVerifyCode(<span class="number">6</span>);</span><br><span class="line">    smsService.sendCode(phone, verifyCode);</span><br><span class="line">    redisTemplate.opsForValue().set(key, verifyCode, RedisConstant.APP_LOGIN_CODE_TTL_SEC, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<p>需要注意防止频繁发送短信。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="部署后端项目"><a href="#部署后端项目" class="headerlink" title="部署后端项目"></a>部署后端项目</h3><h4 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h4><p>使用IDEA的maven插件对项目进行打包，完成后，在<strong>web-admin</strong>和<strong>web-app</strong>模块的<code>target</code>目录下找到<code>web-admin-1.0-SNAPSHOT.jar</code>和<code>web-app-1.0-SNAPSHOT.jar</code>。</p>
<h4 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h4><p>根据前文的部署方案，需要在<code>server01</code>部署后端服务，因此需要在<code>server01</code>中安装JDK，本项目采用JDK17。</p>
<ol>
<li><strong>获取JDK安装包</strong></li>
</ol>
<p>将资料中提前下载好的JDK上传到<code>server01</code>，也在服务器执行以下命令可直接下载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/17/archive/jdk-17.0.8_linux-x64_bin.tar.gz</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>解压JDK安装包</strong></li>
</ol>
<p>执行以下命令将jdk解压到<code>/opt</code>目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-17.0.8_linux-x64_bin.tar.gz -C /opt</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>测试JDK安装效果</strong></li>
</ol>
<p>执行以下命令，观察输出是否正常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/jdk-17.0.8/bin/java -version</span><br></pre></td></tr></table></figure>
<h4 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h4><ol>
<li><p><strong>上传jar包</strong></p>
<p>将后端项目的两个jar包上传到<code>server01</code>服务器的<code>/opt/lease</code>目录下，若目录不存在，自行创建即可。</p>
</li>
<li><p><strong>集成Systemd</strong></p>
<p>为方便项目的启动、停止或者重启，我们同样使用Systemd来管理后端服务的进程。</p>
<ul>
<li><p><strong>移动端集成Systemd</strong></p>
<p>创建<code>lease-app.service</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/lease-app.service</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=lease-app</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/opt/jdk-17.0.8/bin/java -jar /opt/lease/web-app-1.0-SNAPSHOT.jar 1&gt;/opt/lease/app.log 2&gt;&amp;1</span><br><span class="line">SuccessExitStatus=143</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>后台管理系统集成Systemd</strong></p>
<p>创建<code>lease-admin.service</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/lease-admin.service</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=lease-admin</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/opt/jdk-17.0.8/bin/java -jar /opt/lease/web-admin-1.0-SNAPSHOT.jar 1&gt;/opt/lease/admin.log 2&gt;&amp;1</span><br><span class="line">SuccessExitStatus=143</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>启动项目</strong></p>
<p>执行以下命令启动两个后端项目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start lease-app</span><br><span class="line">systemctl start lease-admin</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="部署前端项目"><a href="#部署前端项目" class="headerlink" title="部署前端项目"></a>部署前端项目</h3><h4 id="Nginx配置概述"><a href="#Nginx配置概述" class="headerlink" title="Nginx配置概述"></a>Nginx配置概述</h4><p>移动端和后台管理系统的前端项目均部署在<code>server02</code>的Nginx中，Nginx的配置思路如下图所示</p>
<p><img src="images/部署架构图-详细.drawio.png" style="zoom:50%;" /></p>
<h4 id="移动端"><a href="#移动端" class="headerlink" title="移动端"></a>移动端</h4><h5 id="打包-1"><a href="#打包-1" class="headerlink" title="打包"></a>打包</h5><ol>
<li><p><strong>明确前端请求的后端接口地址</strong></p>
<p>打包之前需要明确前端请求的后台接口地址，根据前文的部署规划，前端请求后台接口时走的是Ngxin反向代理，也就是请求的地址为<code>http://81.68.xxx.xxx:xxx</code>。</p>
<p>所以我们需要修改<code>.env.production</code>文件中<code>VITE_APP_BASE_URL</code>环境变量的值，修改结果如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VITE_APP_BASE_URL</span>=<span class="string">&#x27;http://81.68.xxx.xxx:xxx&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>构建项目</strong></p>
<p>在项目的根目录执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看打包结果</strong></p>
<p>观察项目的根目录是否出现<code>dist</code>目录</p>
</li>
</ol>
<h5 id="部署-2"><a href="#部署-2" class="headerlink" title="部署"></a>部署</h5><ol>
<li><p><strong>上传dist文件</strong></p>
<p>将<code>rentHouseH5</code>项目编译得到<code>dist</code>文件上传至<code>server02</code>服务器的<code>/usr/share/nginx/html/app</code>目录下。</p>
<p>最终的目录结构为</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">└── share</span><br><span class="line">    └── nginx</span><br><span class="line">        └── html</span><br><span class="line">            └── app</span><br><span class="line">                ├── static</span><br><span class="line">                └── index.html</span><br><span class="line">                └── ...              </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编辑Nginx配置文件</strong></p>
<p>创建<code>/etc/nginx/conf.d/app.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/app.conf</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       xxxx;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">81</span>.<span class="number">68</span>.xxx.xxx;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html/app;</span><br><span class="line">        <span class="attribute">index</span>  index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /app &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://81.68.xxx.xxx:xxxx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重新加载Nginx配置文件</strong></p>
<p>执行以下命令重新加载配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问项目</strong></p>
<p>访问<a target="_blank" rel="noopener" href="http://xxxxxx">http://xxxxxx</a></p>
</li>
</ol>
<h4 id="后台管理系统"><a href="#后台管理系统" class="headerlink" title="后台管理系统"></a>后台管理系统</h4><h5 id="打包-2"><a href="#打包-2" class="headerlink" title="打包"></a>打包</h5><ol>
<li><p><strong>明确前端请求的后端接口地址</strong></p>
<p>后台管理系统的前端请求后端接口时，同样会走Nginx反向代理，故其请求的接口地址为<code>http://81.68.xxx.xxx:xxxx</code>。</p>
<p>确保<strong>rentHouseAdmin</strong>项目中的<code>.env.production</code>文件中的<code>VITE_APP_BASE_URL</code>环境变量配置为如下内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VITE_APP_BASE_URL</span>=<span class="string">&#x27;http://81.68.xxx.xxx:xxxx&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>打包</strong></p>
<p>在项目根目录执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看打包结果</strong></p>
<p>观察项目的根目录是否出现<code>dist</code>目录</p>
</li>
</ol>
<h5 id="部署-3"><a href="#部署-3" class="headerlink" title="部署"></a>部署</h5><ol>
<li><p><strong>上传dist文件</strong></p>
<p>将<code>rentHouseAdmin</code>项目编译得到<code>dist</code>文件上传至<code>server02</code>服务器的<code>/usr/share/nginx/html/admin</code>目录下。</p>
<p>最终的目录结构为</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">└── share</span><br><span class="line">    └── nginx</span><br><span class="line">        └── html</span><br><span class="line">            └── admin</span><br><span class="line">                ├── assets</span><br><span class="line">                └── index.html</span><br><span class="line">                └── ...</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编辑Nginx配置文件</strong></p>
<p>创建<code>/etc/nginx/conf.d/admin.conf</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/admin.conf</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       xxxx;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">81</span>.<span class="number">68</span>.xxx.xxx;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html/admin;</span><br><span class="line">        <span class="attribute">index</span>  index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /admin &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://81.68.xx.xxxx:xxxx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重新加载Nginx配置文件</strong></p>
<p>执行以下命令重新加载配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>访问项目</strong></p>
<p>访问<a target="_blank" rel="noopener" href="http://xxxxxx">http://xxxxxx</a></p>
</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93/" rel="tag"># 尚庭公寓</a>
              <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" rel="tag"># 项目实战</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/01/23/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="prev" title="Java设计模式">
      <i class="fa fa-chevron-left"></i> Java设计模式
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/01/25/Nginx%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" rel="next" title="Nginx快速入门">
      Nginx快速入门 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93-03"><span class="nav-number">1.</span> <span class="nav-text">尚硅谷尚庭公寓-03</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ThreadLocal"><span class="nav-number">1.1.</span> <span class="nav-text">ThreadLocal</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.1.2.</span> <span class="nav-text">实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xml%E6%96%87%E4%BB%B6-lt-%E5%92%8C-gt-%E7%9A%84%E8%BD%AC%E4%B9%89"><span class="nav-number">1.2.</span> <span class="nav-text">xml文件&lt;和&gt;的转义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis-Plus%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.3.</span> <span class="nav-text">Mybatis-Plus分页插件注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="nav-number">1.4.</span> <span class="nav-text">异步操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96"><span class="nav-number">1.5.</span> <span class="nav-text">缓存优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.5.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E7%BC%93%E5%AD%98%E9%80%BB%E8%BE%91"><span class="nav-number">1.5.2.</span> <span class="nav-text">编写缓存逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95"><span class="nav-number">1.5.3.</span> <span class="nav-text">压力测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1"><span class="nav-number">1.6.</span> <span class="nav-text">阿里云短信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">1.6.1.</span> <span class="nav-text">获取短信验证码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">1.7.</span> <span class="nav-text">部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.7.1.</span> <span class="nav-text">部署后端项目</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%93%E5%8C%85"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">打包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85JDK"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">安装JDK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-1"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">部署</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.7.2.</span> <span class="nav-text">部署前端项目</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Nginx%E9%85%8D%E7%BD%AE%E6%A6%82%E8%BF%B0"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">Nginx配置概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">移动端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%93%E5%8C%85-1"><span class="nav-number">1.7.2.2.1.</span> <span class="nav-text">打包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-2"><span class="nav-number">1.7.2.2.2.</span> <span class="nav-text">部署</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">后台管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%93%E5%8C%85-2"><span class="nav-number">1.7.2.3.1.</span> <span class="nav-text">打包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-3"><span class="nav-number">1.7.2.3.2.</span> <span class="nav-text">部署</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zongqing Li"
      src="https://github.com/hqulzq/hqulzq.github.io/blob/main/images/head.png?raw=true">
  <p class="site-author-name" itemprop="name">Zongqing Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hqulzq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hqulzq" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hqulzq@163.com" title="E-Mail → mailto:hqulzq@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

      
<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bug%E6%80%BB%E7%BB%93/" rel="tag">Bug总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Knife4j/" rel="tag">Knife4j</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MinIO/" rel="tag">MinIO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis-Plus/" rel="tag">Mybatis-Plus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RocketMQ/" rel="tag">RocketMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diffusion/" rel="tag">diffusion</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/latex/" rel="tag">latex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" rel="tag">代码随想录</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%B4%E5%87%BD%E6%95%B0/" rel="tag">头函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93/" rel="tag">尚庭公寓</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" rel="tag">异常处理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" rel="tag">快速入门</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" rel="tag">技术总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E8%A7%A3/" rel="tag">注解</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%A5%E4%BE%9D/" rel="tag">若依</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BA%E6%96%87/" rel="tag">论文</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8i/" rel="tag">链表i</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" rel="tag">项目实战</a><span class="tag-list-count">6</span></li></ul>
        </canvas>
    </div>
</div>



    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zongqing Li</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #4D4D4C;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #F7F7F7;
      background-image: linear-gradient(#F7F7F7, #F7F7F7);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>

  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('post.copy_button').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('post.copy_success')
          else $(this).text('post.copy_failure')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('post.copy_button')
        }, 300)
      }).append(e)
    })
  </script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":-15,"vOffset":-15},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
