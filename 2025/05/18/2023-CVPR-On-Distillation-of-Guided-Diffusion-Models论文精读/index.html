<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hqulzq.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="全文翻译摘要无分类器引导扩散模型最近在高分辨率图像生成方面表现出了高效性，并已广泛应用于包括DALL·E 2、Stable Diffusion和Imagen在内的大规模扩散框架中。然而，无分类器引导扩散模型的一个缺点是其推理时计算成本较高，因为生成一个样本需要对两个扩散模型（条件模型和无条件模型）进行数十到数百次评估。为解决这一限制，我们提出了一种将无分类器引导扩散模型蒸馏为快速采样模型的方法：给">
<meta property="og:type" content="article">
<meta property="og:title" content="2023-CVPR-On Distillation of Guided Diffusion Models论文精读">
<meta property="og:url" content="https://hqulzq.github.io/2025/05/18/2023-CVPR-On-Distillation-of-Guided-Diffusion-Models%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/index.html">
<meta property="og:site_name" content="Lzq&#39;s blog">
<meta property="og:description" content="全文翻译摘要无分类器引导扩散模型最近在高分辨率图像生成方面表现出了高效性，并已广泛应用于包括DALL·E 2、Stable Diffusion和Imagen在内的大规模扩散框架中。然而，无分类器引导扩散模型的一个缺点是其推理时计算成本较高，因为生成一个样本需要对两个扩散模型（条件模型和无条件模型）进行数十到数百次评估。为解决这一限制，我们提出了一种将无分类器引导扩散模型蒸馏为快速采样模型的方法：给">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-05-18T09:01:27.000Z">
<meta property="article:modified_time" content="2025-05-18T14:29:27.761Z">
<meta property="article:author" content="Zongqing Li">
<meta property="article:tag" content="diffusion">
<meta property="article:tag" content="2023">
<meta property="article:tag" content="CVPR">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://hqulzq.github.io/2025/05/18/2023-CVPR-On-Distillation-of-Guided-Diffusion-Models%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023-CVPR-On Distillation of Guided Diffusion Models论文精读 | Lzq's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lzq's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">48</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">12</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">88</span></a>

  </li>
        <li class="menu-item menu-item-book">

    <a href="/book" rel="section"><i class="fas fa-book fa-fw"></i>Book</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hqulzq.github.io/2025/05/18/2023-CVPR-On-Distillation-of-Guided-Diffusion-Models%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://github.com/hqulzq/hqulzq.github.io/blob/main/images/userimg.jpg?raw=true">
      <meta itemprop="name" content="Zongqing Li">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lzq's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023-CVPR-On Distillation of Guided Diffusion Models论文精读
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-05-18 17:01:27 / 修改时间：22:29:27" itemprop="dateCreated datePublished" datetime="2025-05-18T17:01:27+08:00">2025-05-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="全文翻译"><a href="#全文翻译" class="headerlink" title="全文翻译"></a>全文翻译</h2><h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>无分类器引导扩散模型最近在高分辨率图像生成方面表现出了高效性，并已广泛应用于包括DALL·E 2、Stable Diffusion和Imagen在内的大规模扩散框架中。然而，无分类器引导扩散模型的一个缺点是其推理时计算成本较高，因为生成一个样本需要对两个扩散模型（条件模型和无条件模型）进行数十到数百次评估。为解决这一限制，我们提出了一种将无分类器引导扩散模型蒸馏为快速采样模型的方法：<strong>给定一个预训练的无分类器引导模型，我们首先训练一个单一模型来匹配条件模型和无条件模型的联合输出，然后逐步将该模型蒸馏为一个所需采样步骤更少的扩散模型。</strong>对于在像素空间训练的标准扩散模型，我们的方法仅需4步采样即可生成与原始模型视觉效果相当的图像，在ImageNet 64x64和CIFAR-10数据集上实现了与原始模型相当的FID/IS分数，同时采样速度提高了256倍。对于在隐空间训练的扩散模型（如Stable Diffusion），我们的方法仅需1-4步去噪即可生成高保真图像，在ImageNet 256x256和LAION数据集上的推理速度比现有方法至少提高10倍。我们进一步在文本引导的图像编辑和修复任务中展示了该方法的有效性，其中蒸馏后的模型仅需2-4步去噪即可生成高质量结果。<br><span id="more"></span></p>
<h3 id="1-引言"><a href="#1-引言" class="headerlink" title="1. 引言"></a>1. 引言</h3><p>去噪扩散概率模型（DDPMs）[4,37,39,40]已在图像生成[22,26-28,31]、音频合成[11]、分子生成[44]和似然估计[10]等领域取得了最先进的性能。无分类器引导[6]进一步提升了扩散模型的样本质量，并广泛应用于GLIDE[23]、Stable Diffusion[28]、DALL·E 2[26]和Imagen[31]等大规模扩散模型框架中。然而，无分类器引导的一个关键局限性在于采样效率低——生成一个样本需要对两个扩散模型（条件模型和无条件模型）进行数十到数百次评估。这一限制阻碍了无分类器引导模型在实际场景中的应用。尽管已有针对扩散模型的蒸馏方法[33,38]，但这些方法无法直接应用于无分类器引导的扩散模型。  </p>
<p>为解决这一问题，我们提出一种<code>两阶段蒸馏方法</code>来提升无分类器引导模型的采样效率。<strong>在第一阶段，我们引入单个学生模型来匹配教师模型中两个扩散模型的联合输出。在第二阶段，我们使用[33]中提出的方法，将第一阶段学习到的模型逐步蒸馏为更少步骤的模型。</strong>通过我们的方法，单个蒸馏模型能够处理广泛的引导强度范围，从而高效地在样本质量和多样性之间进行权衡。在对模型进行采样时，我们考虑了文献中的现有确定性采样器[33,38]，并进一步提出了一种随机采样过程。  </p>
<p>我们的蒸馏框架不仅适用于在像素空间训练的标准扩散模型[4,36,39]，还适用于在自动编码器隐空间训练的扩散模型[28,35]（如Stable Diffusion[28]）。对于直接在像素空间训练的扩散模型，我们在ImageNet 64x64和CIFAR-10上的实验表明，所提出的蒸馏模型仅需4步即可生成与教师模型视觉效果相当的样本，并且在广泛的引导强度下，仅需4到16步即可达到与教师模型相当的FID/IS分数（见图2）。对于在编码器隐空间训练的扩散模型[28,35]，我们的方法在ImageNet 256×256和LAION 512×512上仅需1到4步采样即可达到与基础模型相当的视觉质量（比基础模型少至少10倍的步骤），且仅需2-4步采样即可在FID指标上匹配教师模型的性能。据我们所知，我们的工作首次展示了蒸馏方法对像素空间和隐空间无分类器扩散模型的有效性。最后，我们将方法应用于文本引导的图像修复和文本引导的图像编辑任务[20]，将总采样步骤减少至仅2-4步，证明了所提框架在风格迁移和图像编辑应用中的潜力[20,41]。</p>
<h3 id="2-扩散模型背景"><a href="#2-扩散模型背景" class="headerlink" title="2. 扩散模型背景"></a>2. 扩散模型背景</h3><p>给定来自数据分布 $p_{\text{data}}(x)$ 的样本 $x$、噪声调度函数 $\alpha_t$ 和 $\sigma_t$，我们通过最小化加权均方误差来训练参数为 $\theta$ 的扩散模型 $\hat{x}_\theta$ [4,36,39,40]</p>
<script type="math/tex; mode=display">
\mathbb{E}_{t \sim U[0,1], x \sim p_{\text{data}}(x), z_t \sim q(z_t | x)}\left[\omega(\lambda_t)\left\| \hat{x}_\theta(z_t) - x \right\|_2^2\right], \tag{1}</script><p>其中 $\lambda_t = \log[\alpha_t^2 / \sigma_t^2]$ 是信噪比 [10]，$q(z_t | x) = \mathcal{N}(z_t; \alpha_t x, \sigma_t^2 I)$，且 $\omega(\lambda_t)$ 是预定义的加权函数 [10]。</p>
<p>一旦扩散模型 $\hat{x}_\theta$ 训练完成，可使用离散时间 DDIM 采样器 [38] 从模型中采样。具体来说，DDIM 采样器从 $z_1 \sim \mathcal{N}(0, I)$ 开始，并按以下方式更新：</p>
<script type="math/tex; mode=display">
z_s = \alpha_s \hat{x}_\theta(z_t) + \sigma_s \frac{z_t - \alpha_t \hat{x}_\theta(z_t)}{\sigma_t}, \ s = t - 1/N \tag{2}</script><p>其中 $N$ 是总采样步数。最终样本将通过 $\hat{x}_\theta(z_0)$ 生成。</p>
<p><strong>无分类器引导：</strong>无分类器引导 [6] 是一种显著提升条件扩散模型样本质量的有效方法，并已广泛应用于 GLIDE [23]、Stable Diffusion [28]、DALL·E 2 [26] 和 Imagen [31] 等大规模扩散模型框架中。具体而言，它引入引导权重参数 $w \in \mathbb{R}^{\geq 0}$ 以在样本质量和多样性之间进行权衡。生成样本时，无分类器引导在每个更新步骤中同时评估条件扩散模型 $\hat{x}_{c,\theta}$（其中 $c$ 是待条件化的上下文，如类别标签、文本提示）和联合训练的无条件扩散模型 $\hat{x}_\theta$，并使用 $\hat{x}_\theta^w = (1 + w)\hat{x}_{c,\theta} - w\hat{x}_\theta$ 作为公式 (2) 中的模型预测。由于每个采样更新需要评估两个扩散模型，无分类器引导的采样通常计算成本较高 [6]。</p>
<p><strong>渐进蒸馏：</strong>我们的方法受渐进蒸馏 [33] 启发，这是一种通过重复蒸馏提升（无引导）扩散模型采样速度的有效方法。迄今为止，该方法无法直接应用于蒸馏无分类器引导模型，或针对除确定性 DDIM 采样器 [33,38] 之外的采样器进行研究。在本文中，我们解决了这些不足。</p>
<p><strong>隐扩散模型（LDMs）：</strong>隐扩散模型 [21,24,28,35] 通过在预训练正则化自动编码器的隐空间中对图像建模，提高了（直接在像素空间学习的）扩散模型的训练和推理效率，其中隐表示的维度通常低于像素空间。隐扩散模型可被视为级联扩散方法 [5] 的替代方案，后者依赖一个或多个超分辨率扩散模型将低维图像放大至所需目标分辨率。</p>
<p>在这项工作中，我们将把蒸馏框架应用于在像素空间 [4,36,39] 和隐空间 [21,24,28,35] 中学习的无分类器引导扩散模型。</p>
<h3 id="3-引导扩散模型的蒸馏"><a href="#3-引导扩散模型的蒸馏" class="headerlink" title="3. 引导扩散模型的蒸馏"></a>3. 引导扩散模型的蒸馏</h3><p>以下将讨论如何将无分类器引导扩散模型 [6] 蒸馏为采样步骤更少的学生模型。通过条件化引导强度的单个蒸馏模型，我们的模型能够覆盖广泛的无分类器引导水平，从而高效地在样本质量和多样性之间进行权衡。</p>
<p>给定一个在像素空间或隐空间训练的引导模型 $[\hat{x}_{c,\theta}, \hat{x}_\theta]$（教师模型），我们的方法可分解为两个阶段。</p>
<h4 id="3-1-第一阶段蒸馏"><a href="#3-1-第一阶段蒸馏" class="headerlink" title="3.1 第一阶段蒸馏"></a>3.1 第一阶段蒸馏</h4><p>在第一阶段，我们引入一个参数为 $\eta_1$ 的学生模型 $\hat{x}_{\eta_1}(z_t, w)$，以匹配教师模型在任意时间步 $t \in [0,1]$ 的输出。根据教师模型是离散还是连续模型，学生模型可以是连续时间模型 [40] 或离散时间模型 [4,38]。为简化讨论，以下假设学生模型和教师模型均为连续模型，因为离散模型的算法几乎相同。  </p>
<p>无分类器引导 [6] 的一个关键功能是能够通过“引导强度”参数灵活权衡样本质量和多样性，这一特性在实际应用中已被证明有效 [6,23,26,28,31]，其中最优“引导强度”通常由用户偏好决定。因此，我们希望蒸馏后的模型也能保留这一特性。给定感兴趣的引导强度范围 $[w_{\text{min}}, w_{\text{max}}]$，我们使用以下目标优化学生模型：  </p>
<script type="math/tex; mode=display">
\mathbb{E}_{w \sim p_w, t \sim U[0,1], x \sim p_{\text{data}}(x)}\left[\omega(\lambda_t)\left\| \hat{x}_{\eta_1}(z_t, w) - \hat{x}_\theta^w(z_t) \right\|_2^2\right], \tag{3}</script><p>其中 $\hat{x}_\theta^w(z_t) = (1 + w)\hat{x}_{c,\theta}(z_t) - w\hat{x}_\theta(z_t)$，$z_t \sim q(z_t | x)$，且 $p_w(w) = U[w_{\text{min}}, w_{\text{max}}]$。需要注意的是，此处蒸馏后的模型 $\hat{x}_{\eta_1}(z_t, w)$ 也以上下文 $c$（如文本提示）为条件，但为简化表述，本文省略了符号 $c$。补充材料中的算法1提供了详细的训练流程。  </p>
<p>为融入引导权重 $w$，我们引入一个以 $w$ 为条件的模型，其中 $w$ 作为输入馈入学生模型。为更好地捕捉特征，我们对 $w$ 应用傅里叶嵌入，然后以类似于 [10,33] 中融入时间步的方式将其嵌入扩散模型主干。由于初始化对性能至关重要 [33]，我们使用与教师条件模型相同的参数初始化学生模型，但与 $w$ 条件相关的新引入参数除外。我们使用的模型架构为 U-Net，像素空间扩散模型参考 [6]，隐空间扩散模型参考 [1,28]。实验中，我们采用与 [6] 和开源 Stable Diffusion 仓库*相同的通道数和注意力机制，更多细节见补充材料。</p>
<h4 id="3-2-第二阶段蒸馏"><a href="#3-2-第二阶段蒸馏" class="headerlink" title="3.2 第二阶段蒸馏"></a>3.2 第二阶段蒸馏</h4><p>在第二阶段，我们考虑离散时间步场景，并通过逐步将第一阶段学习的模型 $\hat{x}_{\eta_1}(z_t, w)$ 蒸馏为更少步骤的学生模型 $\hat{x}_{\eta_2}(z_t, w)$（参数为 $\eta_2$），每次将采样步数减半。设 $N$ 为采样步数，给定 $w \sim U[w_{\text{min}}, w_{\text{max}}]$ 和 $t \in \{1, \dots, N\}$，我们训练学生模型以单步匹配教师模型的两步 DDIM 采样输出（即从 $t/N$ 到 $t-0.5/N$ 和从 $t-0.5/N$ 到 $t-1/N$），方法参考 [33]。将教师模型的 $2N$ 步蒸馏为学生模型的 $N$ 步后，我们将 $N$ 步学生模型作为新的教师模型，重复上述过程，进一步将教师模型蒸馏为 $N/2$ 步的学生模型。每一步均使用教师模型的参数初始化学生模型。补充材料中提供了训练算法和额外细节。  </p>
<h4 id="3-3-N步确定性与随机采样"><a href="#3-3-N步确定性与随机采样" class="headerlink" title="3.3 N步确定性与随机采样"></a>3.3 N步确定性与随机采样</h4><p>训练完模型 $\hat{x}_{\eta_2}$ 后，给定指定的引导强度 $w \in [w_{\text{min}}, w_{\text{max}}]$，我们可通过公式 (2) 中的 DDIM 更新规则进行采样。值得注意的是，给定蒸馏模型 $\hat{x}_{\eta_2}$，此采样过程在初始化 $z_1^w$ 后是确定性的。实际上，我们还可以执行 $N$ 步随机采样：受 [9] 启发，我们先使用两倍原始步长执行一步确定性采样（即等同于 $N/2$ 步确定性采样器），然后使用原始步长执行一步反向随机步（即添加噪声扰动）。对于 $z_1^w \sim \mathcal{N}(0, I)$，当 $t &gt; 1/N$ 时，使用以下更新规则：</p>
<script type="math/tex; mode=display">
z_k^w = \alpha_k \hat{x}_{\eta_2}(z_t^w) + \sigma_k \frac{z_t^w - \alpha_t \hat{x}_{\eta_2}^w(z_t)}{\sigma_t}, \tag{4}</script><script type="math/tex; mode=display">
\text{其中 } z_s^w = \left(\alpha_s / \alpha_k\right) z_k^w + \sigma_{s|k} \epsilon, \ \epsilon \sim \mathcal{N}(0, I); \tag{5}</script><script type="math/tex; mode=display">
z_h^w = \alpha_h \hat{x}_{\eta_2}(z_s^w) + \sigma_h \frac{z_s^w - \alpha_s \hat{x}_{\eta_2}^w(z_s^w)}{\sigma_s}, \tag{6}</script><script type="math/tex; mode=display">
\text{其中 } z_k^w = \left(\alpha_k / \alpha_h\right) z_h^w + \sigma_{k|h} \epsilon, \ \epsilon \sim \mathcal{N}(0, I). \tag{7}</script><p>上述公式中，$h = t - 3/N$，$k = t - 2/N$，$s = t - 1/N$，且 $\sigma_{a|b}^2 = (1 - e^{\lambda_a - \lambda_b}) \sigma_a^2$。当 $t = 1/N$ 时，使用确定性更新公式 (2) 从 $z_{1/N}^w$ 得到 $z_0^w$。图5以4步去噪为例展示了该过程。需要注意的是，与确定性采样器相比，随机采样需要在略有不同的时间步评估模型，并且需要对边缘情况的训练算法进行小幅修改。补充材料中提供了具体算法和更多细节。</p>
<h3 id="4-实验"><a href="#4-实验" class="headerlink" title="4. 实验"></a>4. 实验</h3><p>在本节中，我们评估了蒸馏方法在像素空间扩散模型（即DDPM [4]）和隐空间扩散模型（即Stable Diffusion [28]）上的性能。我们进一步将该方法应用于文本引导的图像编辑和修复任务。实验表明，我们的方法在所有任务中仅需2-4步即可实现具有竞争力的性能。  </p>
<h4 id="4-1-像素空间引导模型的蒸馏"><a href="#4-1-像素空间引导模型的蒸馏" class="headerlink" title="4.1 像素空间引导模型的蒸馏"></a>4.1 像素空间引导模型的蒸馏</h4><p>在本实验中，我们考虑直接在像素空间训练的类别条件扩散模型[4,6,33]。  </p>
<p><strong>实验设置：</strong>我们主要关注ImageNet 64x64 [30]和CIFAR-10 [12]数据集，因为在此场景下的高分辨率图像生成通常需要结合其他超分辨率技术[5,31]。我们探索了引导权重的不同范围，发现所有范围的表现相当，因此实验中使用$[w_{\text{min}}, w_{\text{max}}] = [0, 4]$。我们考虑的基线包括DDPM祖先采样[4]和DDIM [38]。我们使用的教师模型是1024×2步的DDIM模型，其中条件和无条件组件均使用1024步DDIM去噪。为了更好地理解引导权重$w$的整合方式，我们还包括使用单一固定$w$训练的模型作为基线。为了公平比较，所有方法均使用相同的预训练教师模型。遵循[4,6,39]，基线模型使用U-Net [29,39]架构，而我们的两步学生模型则使用引入$w$嵌入的相同U-Net主干（见第3节）。根据[33]，两个数据集均使用$v$-预测模型。  </p>
<p><strong>实验结果：</strong>我们在图6和表1中报告了所有方法在ImageNet 64x64上的FID [3]和Inception分数（IS）[32]性能，并在补充材料中提供了扩展的ImageNet 64x64和CIFAR-10结果。我们观察到，我们的蒸馏模型仅需4-16步即可匹配使用1024×2步采样的教师引导DDIM模型，实现高达256倍的加速。需要强调的是，通过我们的方法，单个蒸馏模型能够在广泛的引导强度范围内匹配教师模型的性能，这是以往方法从未实现的。  </p>
<h4 id="4-2-隐空间引导模型的蒸馏"><a href="#4-2-隐空间引导模型的蒸馏" class="headerlink" title="4.2 隐空间引导模型的蒸馏"></a>4.2 隐空间引导模型的蒸馏</h4><p>在4.1节展示了我们的方法在像素空间类别引导扩散模型上的有效性后，现在将其扩展到隐空间扩散模型。在以下章节中，我们将展示该方法在Latent Diffusion [28]的各种任务上的有效性，包括类别条件生成、文本到图像生成、图像修复和文本引导的风格迁移[20]。  </p>
<p>在以下实验中，我们使用开源的隐空间扩散模型[28]作为教师模型。由于$v$-预测教师模型往往比$\epsilon$-预测模型表现更好，我们将开源的$\epsilon$-预测模型微调为$v$-预测教师模型，更多细节见补充材料。  </p>
<h5 id="4-2-1-类别条件生成"><a href="#4-2-1-类别条件生成" class="headerlink" title="4.2.1 类别条件生成"></a>4.2.1 类别条件生成</h5><p>在本节中，我们将方法应用于在ImageNet 256×256上预训练的类别条件隐扩散模型。我们从具有512步采样的DDIM教师模型开始，并使用其输出作为目标来训练蒸馏模型。训练期间使用批量大小为512，并均匀采样引导强度$w \in [w_{\text{min}}=0, w_{\text{max}}=14]$。  </p>
<p><strong>实验结果：</strong>根据经验，我们发现蒸馏模型在FID分数上仅需2或4步采样即可匹配教师模型（原始训练为1000步）的性能。在使用1-4步采样时，其性能也显著优于DDIM（见图11）。从定性结果来看，使用单步去噪生成的样本仍能产生令人满意的结果，而基线模型则无法生成有意义内容的图像。补充材料中提供了额外样本。  </p>
<p>与图6中基于像素的结果类似，我们还观察到蒸馏隐扩散模型在FID和Inception分数衡量下的采样质量与多样性之间的权衡。遵循Kynkäänniemi等人[13]，我们在附录中进一步计算了本实验的改进精度和召回率指标。  </p>
<h5 id="4-2-2-文本引导的图像生成"><a href="#4-2-2-文本引导的图像生成" class="headerlink" title="4.2.2 文本引导的图像生成"></a>4.2.2 文本引导的图像生成</h5><p>在本节中，我们聚焦于在LAION-5B [34]子集上预训练的文本引导Stable Diffusion模型，分辨率为512×512。然后，我们按照第3节介绍的两阶段方法，通过3000次梯度更新将引导模型蒸馏为$w$-条件模型，其中$w \in [w_{\text{min}}=2, w_{\text{max}}=14]$，批量大小为512。尽管蒸馏（学生）模型可以适应更广泛的$w$范围，但由于使用教师模型采样时通常不超过正常引导范围，其实际效用尚不明确。除了1、2和4步的低步骤方案需要20000次梯度更新外，最终模型通过每阶段2000次训练步骤的渐进蒸馏获得。补充材料中提供了该模型收敛特性的详细分析。  </p>
<p><strong>实验结果：</strong>我们在图4中展示了样本，并从定性和定量两方面评估了所得模型。对于后者分析，我们遵循[31]，分别使用CLIP [25]和FID分数评估文本-图像对齐和质量。我们使用开源的ViT-g/14 [7] CLIP模型进行评估。图10中的定量结果表明，在2步和4步采样时，我们的方法在两项指标上均显著优于基础模型的DDIM采样。对于8步采样，这些指标没有显著差异。然而，当查看图7中的对应样本时，我们可以观察到视觉图像质量的明显差异。与原始模型的8步DDIM样本相比，蒸馏样本更清晰、更连贯。我们假设在COCO2017 [14]验证集的5000个随机字幕评估中，FID和CLIP未能完全捕捉这些差异。我们进一步计算了蒸馏LAION 512x512模型的FID和CLIP分数，并在表2中与DPM [16]和DPM++ [18]求解器进行比较。我们观察到，在去噪步骤为2或4时，我们的方法能够实现显著更好的性能。此外，我们强调，方法的第一阶段已将函数评估次数减少了一半，因为我们将无分类器引导步骤蒸馏为单个模型。根据具体实现（批量与顺序网络评估），这与现有求解器[16,18,38]相比，减少了峰值内存或采样时间。  </p>
<h5 id="4-2-3-文本引导的图像到图像翻译"><a href="#4-2-3-文本引导的图像到图像翻译" class="headerlink" title="4.2.3 文本引导的图像到图像翻译"></a>4.2.3 文本引导的图像到图像翻译</h5><p>在本节中，我们使用4.2.2节的蒸馏模型，结合SDEdit [20]进行文本引导的图像到图像翻译实验。遵循SDEdit [20]，我们在隐空间中执行随机编码，但使用蒸馏模型的确定性采样器进行确定性解码。我们考虑各种输入图像和文本，并在图8中提供定性结果。我们观察到，我们的蒸馏模型仅需3步去噪即可生成高质量的风格迁移结果。补充材料中提供了样本质量、可控性和效率之间权衡的更多分析。  </p>
<h5 id="4-2-4-图像修复"><a href="#4-2-4-图像修复" class="headerlink" title="4.2.4 图像修复"></a>4.2.4 图像修复</h5><p>在本节中，我们将方法应用于预训练的图像修复隐扩散模型。我们使用开源的Stable Diffusion Inpainting‡图像修复模型，该模型是上述纯文本到图像Stable Diffusion模型的微调版本，其中添加了额外的输入通道以处理掩码和掩码图像。  </p>
<p>我们使用与前一节相同的蒸馏算法。训练时，我们从使用512步DDIM采样的$v$-预测教师模型开始，并使用其输出作为目标来优化学生模型。我们在图9中展示了定性结果，证明了我们的方法在快速、实际图像编辑应用中的潜力。更多训练细节和定量评估见补充材料。  </p>
<h4 id="4-3-编码的渐进蒸馏"><a href="#4-3-编码的渐进蒸馏" class="headerlink" title="4.3 编码的渐进蒸馏"></a>4.3 编码的渐进蒸馏</h4><p>在本实验中，我们探索蒸馏教师模型的编码过程，并在类似于[41]的设置中进行风格迁移实验。我们聚焦于在ImageNet 64×64上预训练的像素空间扩散模型。具体而言，为了在两个域A和B之间进行风格迁移，我们使用在域A上训练的扩散模型对域A的图像进行编码，然后使用在域B上训练的扩散模型进行DDIM解码。由于编码过程可视为逆DDIM采样过程，我们对带无分类器引导的编码器和解码器均进行了蒸馏，并在图12中与DDIM编码器和解码器进行了比较。我们还探索了修改引导强度$w$如何影响性能，更多细节见补充材料。</p>
<h3 id="5-相关工作"><a href="#5-相关工作" class="headerlink" title="5. 相关工作"></a>5. 相关工作</h3><p>我们的方法与现有提升扩散模型采样速度的研究相关[4,37,40]。例如，去噪扩散隐式模型（DDIM [38]）、概率流采样器[40]、快速SDE积分器[8]等方法已被提出用于提升扩散模型的采样速度。其他研究则开发了高阶求解器[17]、指数积分器[15]和基于动态规划的方法[43]来加速采样。然而，这些方法在蒸馏无分类器引导扩散模型方面均未达到与我们方法可比的性能。  </p>
<p>现有的基于蒸馏的扩散模型方法主要针对非无分类器引导的扩散模型。例如，[19]提出通过反转DDIM的确定性编码来单步从噪声预测数据，[2]提出通过将高阶求解器蒸馏为神经网络主干的额外预测头来实现更快的采样速度。渐进蒸馏[33]可能是最相关的工作，该方法提出将预训练扩散模型逐步蒸馏为具有相同架构但更少步骤的学生模型。然而，这些方法均无法直接应用于无分类器引导的扩散模型，也无法使用单个蒸馏模型覆盖不同的引导强度范围。相比之下，通过将引导强度融入模型架构并采用两阶段训练过程，我们的方法能够使用单个模型在广泛的引导强度范围内匹配教师模型的性能。通过我们的方法，单个模型即可捕捉样本质量与多样性的权衡，从而推动无分类器引导扩散模型在用户通常需要指定引导强度的实际场景中的应用。此外，上述蒸馏方法均未应用于隐空间文本到图像模型，也未展示其有效性。最后，大多数快速采样方法[33,38,40]仅考虑使用确定性采样方案来提升采样速度，而本工作进一步开发了一种有效的随机采样方法从蒸馏模型中采样。</p>
<h3 id="6-结论"><a href="#6-结论" class="headerlink" title="6. 结论"></a>6. 结论</h3><p>在本文中，我们提出了一种针对引导扩散模型[6]的蒸馏方法。我们的两阶段方法能够显著加速流行但效率相对较低的引导扩散模型。实验表明，该方法可将无分类器引导的像素空间和隐空间扩散模型的推理成本至少降低一个数量级。从经验上看，我们的方法仅需2步即可生成视觉上吸引人的结果，仅用4到8步即可达到与教师模型相当的FID分数。我们进一步在文本引导的图像到图像翻译和修复任务中展示了蒸馏方法的实际应用。我们希望通过显著降低无分类器引导扩散模型的推理成本，推动其在创意应用和图像生成系统中的广泛应用。未来工作中，我们旨在进一步提升2步和1步采样方案的性能。</p>
<h3 id="A-结果概述"><a href="#A-结果概述" class="headerlink" title="A. 结果概述"></a>A. 结果概述</h3><p>在本节中，我们提供了像素空间和隐空间扩散模型加速效果的概述表（见表3）。我们还在图13和图14中提供了文本引导图像生成模型的额外样本，并与DDIM [38]、DPM [17]和DPM++ [18]求解器进行了比较。像素空间蒸馏的更多实验细节见附录B，隐空间蒸馏见附录C。</p>
<h3 id="B-像素空间蒸馏"><a href="#B-像素空间蒸馏" class="headerlink" title="B. 像素空间蒸馏"></a>B. 像素空间蒸馏</h3><h4 id="B-1-教师模型"><a href="#B-1-教师模型" class="headerlink" title="B.1 教师模型"></a>B.1 教师模型</h4><p>我们使用的模型架构是类似于[6]中使用的U-Net模型。如[33]所述，该模型被参数化以预测$v$。我们使用与[6]相同的训练设置。  </p>
<h4 id="B-2-第一阶段蒸馏"><a href="#B-2-第一阶段蒸馏" class="headerlink" title="B.2 第一阶段蒸馏"></a>B.2 第一阶段蒸馏</h4><p>我们使用的模型架构是类似于[6]中使用的U-Net模型。对于ImageNet 64x64和CIFAR-10，我们使用与[6]相同的通道数和注意力机制。如第3节所述，我们还使模型将$w$作为输入。具体来说，我们在将$w$与模型主干结合之前，对其应用傅里叶嵌入。我们融入$w$的方式与[10,33]中融入时间步的方式相同。如[33]所述，我们将模型参数化以预测$v$。我们使用算法1训练蒸馏模型，采用SNR损失[10,33]。对于ImageNet 64x64，我们使用学习率$3e-4$，指数移动平均（EMA）衰减0.9999；对于CIFAR-10，使用学习率$1e-3$，EMA衰减0.9999。除了与$w$-嵌入相关的参数外，我们使用教师模型的参数初始化学生模型。  </p>
<h4 id="B-3-确定性采样器的第二阶段蒸馏"><a href="#B-3-确定性采样器的第二阶段蒸馏" class="headerlink" title="B.3 确定性采样器的第二阶段蒸馏"></a>B.3 确定性采样器的第二阶段蒸馏</h4><p>我们使用与第一阶段（见附录B.2）相同的模型架构。我们使用算法2训练蒸馏模型。我们首先将第一阶段的学生模型作为教师模型。从1024步DDIM采样开始，逐步将第一阶段的学生模型蒸馏为单步模型。在将采样步数减半并将学生模型作为新的教师模型之前，我们对学生模型进行50,000次参数更新，对于采样步数等于1或2的情况，则进行100,000次参数更新。在每个采样步骤，我们使用教师模型的参数初始化学生模型。我们使用SNR截断损失[10,33]训练模型。在每个步骤中，我们在参数更新过程中从$1e-4$到0线性退火学习率。训练时不使用EMA衰减，我们的训练设置与[33]非常接近。  </p>
<h4 id="B-4-随机采样的第二阶段蒸馏"><a href="#B-4-随机采样的第二阶段蒸馏" class="headerlink" title="B.4 随机采样的第二阶段蒸馏"></a>B.4 随机采样的第二阶段蒸馏</h4><p>我们使用算法3训练蒸馏模型。对于ImageNet 64x64和CIFAR-10，我们使用与附录B.3中确定性采样的第二阶段蒸馏相同的模型架构和训练设置：这里的主要区别在于，我们的蒸馏目标对应于采用比确定性采样器大两倍的采样步长。我们在图15中提供了不同引导强度$w$的样本可视化。</p>
<h4 id="B-5-基线样本"><a href="#B-5-基线样本" class="headerlink" title="B.5 基线样本"></a>B.5 基线样本</h4><p>我们在图16和图17中提供了DDIM基线的额外样本。</p>
<h4 id="B-6-额外蒸馏结果"><a href="#B-6-额外蒸馏结果" class="headerlink" title="B.6 额外蒸馏结果"></a>B.6 额外蒸馏结果</h4><p>我们在图22b、图22a和表4中提供了我们的方法和基线在ImageNet 64x64和CIFAR-10上的FID和IS结果。我们还在图18和图19中可视化了两个数据集的FID和IS权衡曲线，其中我们为ImageNet 64x64选择引导强度$w = \{0, 0.3, 1, 2, 4\}$，为CIFAR-10选择$w = \{0, 0.1, 0.2, 0.3, 0.5, 0.7, 1, 2, 4\}$。</p>
<h4 id="B-7-风格迁移"><a href="#B-7-风格迁移" class="headerlink" title="B.7 风格迁移"></a>B.7 风格迁移</h4><p>我们在ImageNet 64x64上进行此实验。如[41]所述，通过使用在域A上训练的扩散模型对图像进行编码（执行反向DDIM），然后使用在域B上训练的扩散模型通过DDIM进行解码，可以在域A和域B之间进行风格迁移。我们使用算法4训练模型，采用与附录B.3中讨论的相同的$w$-条件模型架构和训练设置。</p>
<p>对无分类器引导模型进行渐进蒸馏[33]的一种自然方法是使用与教师结构相同的蒸馏学生模型——即具有联合训练的蒸馏条件和无条件扩散组件。记预训练教师模型为$[\hat{x}_{c,\theta}, \hat{x}_\theta]$，学生模型为$[\hat{x}_{c,\eta}, \hat{x}_\eta]$，我们在算法5中提供了训练算法。要从训练好的模型中采样，可以使用DDIM确定性采样器[38]或提出的随机采样器。我们遵循附录B.3中的训练设置，使用$w$-条件模型，并训练模型以适应引导强度$[0, 4]$。我们观察到，使用算法5蒸馏的模型在采样步数较少时无法生成合理的样本。我们在图23中提供了使用DDIM采样器在CIFAR-10上生成的样本，并在表5中提供了FID/IS分数。</p>
<h4 id="B-8-朴素蒸馏方法"><a href="#B-8-朴素蒸馏方法" class="headerlink" title="B.8 朴素蒸馏方法"></a>B.8 朴素蒸馏方法</h4><p>对无分类器引导模型进行渐进蒸馏 [33] 的一种自然方法是使用与教师结构相同的蒸馏学生模型 —— 即具有联合训练的蒸馏条件和无条件扩散组件。记预训练教师模型为$[\hat{x}_{c,\theta}, \hat{x}_\theta]$，学生模型为$[\hat{x}_{c,\eta}, \hat{x}_\eta]$，我们在算法 5 中提供了训练算法。要从训练好的模型中采样，可以使用 DDIM 确定性采样器 [38] 或提出的随机采样器。我们遵循附录 B.3 中的训练设置，使用w- 条件模型，并训练模型以适应引导强度$[0, 4]$。我们观察到，使用算法 5 蒸馏的模型在采样步数较少时无法生成合理的样本。我们在图 23 中提供了使用 DDIM 采样器在 CIFAR-10 上生成的样本，并在表 5 中提供了 FID/IS 分数。</p>
<h3 id="C-隐空间蒸馏"><a href="#C-隐空间蒸馏" class="headerlink" title="C. 隐空间蒸馏"></a>C. 隐空间蒸馏</h3><h4 id="C-1-类别条件生成"><a href="#C-1-类别条件生成" class="headerlink" title="C.1 类别条件生成"></a>C.1 类别条件生成</h4><h5 id="C-1-1-训练细节"><a href="#C-1-1-训练细节" class="headerlink" title="C.1.1 训练细节"></a>C.1.1 训练细节</h5><p>在本实验中，我们考虑ImageNet 256×256上的类别条件生成任务。我们首先将原始的ϵ-预测模型微调为v-预测模型，然后从具有512步采样的DDIM教师模型开始，使用其输出作为目标来训练我们的蒸馏模型。在第一阶段，我们使用常数损失[10,33]对模型进行2000次梯度更新训练。在第二阶段，除了采样步数为1、2或4时需要20000次梯度更新外，我们对模型进行2000次梯度更新训练。第二阶段模型使用SNR截断损失[10,33]进行训练。在两个阶段中，我们都进行了额外的500步学习率热身，其中学习率从0线性增加到目标学习率。训练期间使用批量大小为2048，并均匀采样引导强度$w \in [w_{\text{min}}=0, w_{\text{max}}=14]$。</p>
<p><strong>补充结果：</strong>我们在图25中提供了通过精度和召回率评估的定量结果。这些结果证实了我们的方法在少步数场景下的显著性能提升，尤其是在1-4步采样时。我们的2步和4步采样蒸馏隐扩散模型在精度上接近32步DDIM的性能，在低步数时的召回率显著优于DDIM。更多定性结果见图25，其中我们展示了1步和2步模型的随机样本，并与DDIM采样进行了对比。</p>
<h4 id="C-2-文本引导的图像生成"><a href="#C-2-文本引导的图像生成" class="headerlink" title="C.2 文本引导的图像生成"></a>C.2 文本引导的图像生成</h4><h5 id="C-2-1-训练细节"><a href="#C-2-1-训练细节" class="headerlink" title="C.2.1 训练细节"></a>C.2.1 训练细节</h5><p>在本实验中，我们考虑分辨率为256×256和512×512的LAION-5B数据集。</p>
<p><strong>LAION-5B 256×256：</strong>与附录C.1类似，我们首先将原始的ϵ-预测模型微调为v-预测模型。我们从具有512步采样的DDIM教师模型开始，使用其输出作为目标来训练蒸馏模型。在第一阶段，我们使用常数损失[10,33]对模型进行2000-5000次梯度更新训练。在第二阶段，除了采样步数为1、2或4时需要10000-50000次梯度更新外，我们对模型进行2000-5000次梯度更新训练。第二阶段模型使用SNR截断损失[10,33]进行训练。在两个阶段中，我们都进行了额外的100-1000步学习率热身。训练期间使用批量大小为1024，并均匀采样引导强度$w \in [w_{\text{min}}=2, w_{\text{max}}=14]$。<br>图26提供了上述不同训练设置的收敛性分析。我们观察到，我们的方法在几千次训练迭代后接近基础模型的DDIM采样性能，并在1步和2步场景中迅速超越。然而，为了达到最佳性能，需要更长时间的训练。</p>
<p><strong>LAION-5B 512×512：</strong>类似地，我们首先将原始的ϵ-预测模型微调为v-预测模型。我们从具有512步采样的DDIM教师模型开始，使用其输出作为目标来训练蒸馏模型。在第一阶段，我们使用常数损失[10,33]对模型进行2000-5000次梯度更新训练。在第二阶段，除了采样步数为1、2或4时需要10000-50000次梯度更新外，我们对模型进行2000-5000次梯度更新训练。第二阶段模型使用SNR截断损失[10,33]进行训练。在两个阶段中，我们都进行了额外的1000步学习率热身。训练期间使用批量大小为512，并均匀采样引导强度$w \in [w_{\text{min}}=2, w_{\text{max}}=14]$。</p>
<p><strong>补充结果：</strong>除了DDIM，我们还在此处将我们的方法与DPM++-Solver[16,18]进行了比较，这是一种先进的采样器，无需额外训练，且在隐扩散模型的≥10步采样中取得了良好结果。与我们的蒸馏模型不同，该方法与DDIM类似，必须使用无分类器引导才能获得良好结果，这使得U-Net评估次数比我们的w-条件化方法增加了一倍。<br>我们在图28中提供了这些采样方法的定性比较，从中可以清楚地看到我们的蒸馏方法在少步数时的优势：我们的方法比无需训练的采样器生成的结果更清晰、更连贯。这种表现反映在图27和表6、表7的定量FID和CLIP分析中。尽管此处的加速效果不如像素空间显著，但我们的方法在2步或4步采样时仍能取得非常好的结果。由于w-条件化（因为此处我们不再需要为无分类器引导评估无条件模型和条件模型，只需要一个蒸馏的w-条件模型），我们的方法与现有方法相比，进一步将峰值内存或去噪步骤减少了一半。我们希望我们的工作将推动通用高分辨率文本到图像系统在实时应用中的进展。</p>
<h4 id="C-3-文本引导的图像到图像翻译"><a href="#C-3-文本引导的图像到图像翻译" class="headerlink" title="C.3 文本引导的图像到图像翻译"></a>C.3 文本引导的图像到图像翻译</h4><h5 id="C-3-1-训练细节"><a href="#C-3-1-训练细节" class="headerlink" title="C.3.1 训练细节"></a>C.3.1 训练细节</h5><p>我们使用为文本引导图像生成训练的模型，训练细节见附录C.2。</p>
<h5 id="C-3-2-额外分析"><a href="#C-3-2-额外分析" class="headerlink" title="C.3.2 额外分析"></a>C.3.2 额外分析</h5><p>我们在图30和图31中提供了样本质量、可控性和效率之间权衡的更多分析。与[20]类似，我们还观察到，随着初始扰动噪声水平的增加，真实性、可控性和忠实性之间存在权衡：添加的噪声越多，图像与文本提示的对齐越好，但对输入图像的忠实度越低（见图30和图31）。</p>
<h4 id="C-4-图像修复"><a href="#C-4-图像修复" class="headerlink" title="C.4 图像修复"></a>C.4 图像修复</h4><h5 id="C-4-1-训练细节"><a href="#C-4-1-训练细节" class="headerlink" title="C.4.1 训练细节"></a>C.4.1 训练细节</h5><p>与我们之前的实验类似，我们使用LAMA[42]建议的大掩码生成方案将ϵ-预测模型微调为v-预测模型，并在512×512分辨率的LAION-5B上进行训练。我们从具有512步采样的DDIM教师模型开始，使用其输出作为目标来训练蒸馏模型。在第一阶段，我们使用常数损失[10,33]对模型进行2000次梯度更新训练。在第二阶段，除了采样步数为1或2时需要5000次梯度更新外，我们对模型进行10000次梯度更新训练。第二阶段模型使用SNR截断损失[10,33]进行训练。在两个阶段中，我们都进行了额外的1000步学习率热身。训练期间使用批量大小为512，并均匀采样引导强度$w \in [w_{\text{min}}=2, w_{\text{max}}=14]$。</p>
<p><strong>补充评估结果：</strong>与低采样步数的DDIM采样的定量比较见Tab.8，额外样本见图32。</p>
<h3 id="D-像素空间蒸馏的额外样本"><a href="#D-像素空间蒸馏的额外样本" class="headerlink" title="D. 像素空间蒸馏的额外样本"></a>D. 像素空间蒸馏的额外样本</h3><p>在本节中，我们为像素空间蒸馏模型提供了额外的样本。我们使用确定性采样器（见算法2）和随机采样器（见算法3）生成样本。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/diffusion/" rel="tag"># diffusion</a>
              <a href="/tags/2023/" rel="tag"># 2023</a>
              <a href="/tags/CVPR/" rel="tag"># CVPR</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/05/14/2024-CVPR-Fast-ODE-based-Sampling-for-Diffusion-Models-in-Around-5-Steps%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/" rel="prev" title="2024-CVPR-Fast ODE-based Sampling for Diffusion Models in Around 5 Steps论文精读">
      <i class="fa fa-chevron-left"></i> 2024-CVPR-Fast ODE-based Sampling for Diffusion Models in Around 5 Steps论文精读
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/05/18/idea%E8%AE%B0%E5%BD%95/" rel="next" title="idea记录">
      idea记录 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E6%96%87%E7%BF%BB%E8%AF%91"><span class="nav-number">1.</span> <span class="nav-text">全文翻译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%91%98%E8%A6%81"><span class="nav-number">1.1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%BC%95%E8%A8%80"><span class="nav-number">1.2.</span> <span class="nav-text">1. 引言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B%E8%83%8C%E6%99%AF"><span class="nav-number">1.3.</span> <span class="nav-text">2. 扩散模型背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%BC%95%E5%AF%BC%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%92%B8%E9%A6%8F"><span class="nav-number">1.4.</span> <span class="nav-text">3. 引导扩散模型的蒸馏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E8%92%B8%E9%A6%8F"><span class="nav-number">1.4.1.</span> <span class="nav-text">3.1 第一阶段蒸馏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E8%92%B8%E9%A6%8F"><span class="nav-number">1.4.2.</span> <span class="nav-text">3.2 第二阶段蒸馏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-N%E6%AD%A5%E7%A1%AE%E5%AE%9A%E6%80%A7%E4%B8%8E%E9%9A%8F%E6%9C%BA%E9%87%87%E6%A0%B7"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.3 N步确定性与随机采样</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%9E%E9%AA%8C"><span class="nav-number">1.5.</span> <span class="nav-text">4. 实验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E5%83%8F%E7%B4%A0%E7%A9%BA%E9%97%B4%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%92%B8%E9%A6%8F"><span class="nav-number">1.5.1.</span> <span class="nav-text">4.1 像素空间引导模型的蒸馏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E9%9A%90%E7%A9%BA%E9%97%B4%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%92%B8%E9%A6%8F"><span class="nav-number">1.5.2.</span> <span class="nav-text">4.2 隐空间引导模型的蒸馏</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-%E7%B1%BB%E5%88%AB%E6%9D%A1%E4%BB%B6%E7%94%9F%E6%88%90"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">4.2.1 类别条件生成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-%E6%96%87%E6%9C%AC%E5%BC%95%E5%AF%BC%E7%9A%84%E5%9B%BE%E5%83%8F%E7%94%9F%E6%88%90"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">4.2.2 文本引导的图像生成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-3-%E6%96%87%E6%9C%AC%E5%BC%95%E5%AF%BC%E7%9A%84%E5%9B%BE%E5%83%8F%E5%88%B0%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%AF%91"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">4.2.3 文本引导的图像到图像翻译</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-4-%E5%9B%BE%E5%83%8F%E4%BF%AE%E5%A4%8D"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">4.2.4 图像修复</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-%E7%BC%96%E7%A0%81%E7%9A%84%E6%B8%90%E8%BF%9B%E8%92%B8%E9%A6%8F"><span class="nav-number">1.5.3.</span> <span class="nav-text">4.3 编码的渐进蒸馏</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.6.</span> <span class="nav-text">5. 相关工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E7%BB%93%E8%AE%BA"><span class="nav-number">1.7.</span> <span class="nav-text">6. 结论</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#A-%E7%BB%93%E6%9E%9C%E6%A6%82%E8%BF%B0"><span class="nav-number">1.8.</span> <span class="nav-text">A. 结果概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-%E5%83%8F%E7%B4%A0%E7%A9%BA%E9%97%B4%E8%92%B8%E9%A6%8F"><span class="nav-number">1.9.</span> <span class="nav-text">B. 像素空间蒸馏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#B-1-%E6%95%99%E5%B8%88%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.9.1.</span> <span class="nav-text">B.1 教师模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-2-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E8%92%B8%E9%A6%8F"><span class="nav-number">1.9.2.</span> <span class="nav-text">B.2 第一阶段蒸馏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-3-%E7%A1%AE%E5%AE%9A%E6%80%A7%E9%87%87%E6%A0%B7%E5%99%A8%E7%9A%84%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E8%92%B8%E9%A6%8F"><span class="nav-number">1.9.3.</span> <span class="nav-text">B.3 确定性采样器的第二阶段蒸馏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-4-%E9%9A%8F%E6%9C%BA%E9%87%87%E6%A0%B7%E7%9A%84%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E8%92%B8%E9%A6%8F"><span class="nav-number">1.9.4.</span> <span class="nav-text">B.4 随机采样的第二阶段蒸馏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-5-%E5%9F%BA%E7%BA%BF%E6%A0%B7%E6%9C%AC"><span class="nav-number">1.9.5.</span> <span class="nav-text">B.5 基线样本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-6-%E9%A2%9D%E5%A4%96%E8%92%B8%E9%A6%8F%E7%BB%93%E6%9E%9C"><span class="nav-number">1.9.6.</span> <span class="nav-text">B.6 额外蒸馏结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-7-%E9%A3%8E%E6%A0%BC%E8%BF%81%E7%A7%BB"><span class="nav-number">1.9.7.</span> <span class="nav-text">B.7 风格迁移</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-8-%E6%9C%B4%E7%B4%A0%E8%92%B8%E9%A6%8F%E6%96%B9%E6%B3%95"><span class="nav-number">1.9.8.</span> <span class="nav-text">B.8 朴素蒸馏方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-%E9%9A%90%E7%A9%BA%E9%97%B4%E8%92%B8%E9%A6%8F"><span class="nav-number">1.10.</span> <span class="nav-text">C. 隐空间蒸馏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#C-1-%E7%B1%BB%E5%88%AB%E6%9D%A1%E4%BB%B6%E7%94%9F%E6%88%90"><span class="nav-number">1.10.1.</span> <span class="nav-text">C.1 类别条件生成</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#C-1-1-%E8%AE%AD%E7%BB%83%E7%BB%86%E8%8A%82"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">C.1.1 训练细节</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C-2-%E6%96%87%E6%9C%AC%E5%BC%95%E5%AF%BC%E7%9A%84%E5%9B%BE%E5%83%8F%E7%94%9F%E6%88%90"><span class="nav-number">1.10.2.</span> <span class="nav-text">C.2 文本引导的图像生成</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#C-2-1-%E8%AE%AD%E7%BB%83%E7%BB%86%E8%8A%82"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">C.2.1 训练细节</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C-3-%E6%96%87%E6%9C%AC%E5%BC%95%E5%AF%BC%E7%9A%84%E5%9B%BE%E5%83%8F%E5%88%B0%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%AF%91"><span class="nav-number">1.10.3.</span> <span class="nav-text">C.3 文本引导的图像到图像翻译</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#C-3-1-%E8%AE%AD%E7%BB%83%E7%BB%86%E8%8A%82"><span class="nav-number">1.10.3.1.</span> <span class="nav-text">C.3.1 训练细节</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#C-3-2-%E9%A2%9D%E5%A4%96%E5%88%86%E6%9E%90"><span class="nav-number">1.10.3.2.</span> <span class="nav-text">C.3.2 额外分析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C-4-%E5%9B%BE%E5%83%8F%E4%BF%AE%E5%A4%8D"><span class="nav-number">1.10.4.</span> <span class="nav-text">C.4 图像修复</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#C-4-1-%E8%AE%AD%E7%BB%83%E7%BB%86%E8%8A%82"><span class="nav-number">1.10.4.1.</span> <span class="nav-text">C.4.1 训练细节</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#D-%E5%83%8F%E7%B4%A0%E7%A9%BA%E9%97%B4%E8%92%B8%E9%A6%8F%E7%9A%84%E9%A2%9D%E5%A4%96%E6%A0%B7%E6%9C%AC"><span class="nav-number">1.11.</span> <span class="nav-text">D. 像素空间蒸馏的额外样本</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zongqing Li"
      src="https://github.com/hqulzq/hqulzq.github.io/blob/main/images/userimg.jpg?raw=true">
  <p class="site-author-name" itemprop="name">Zongqing Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">88</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hqulzq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hqulzq" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hqulzq@163.com" title="E-Mail → mailto:hqulzq@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

      
<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2019/" rel="tag">2019</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2020/" rel="tag">2020</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2021/" rel="tag">2021</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2022/" rel="tag">2022</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2023/" rel="tag">2023</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2024/" rel="tag">2024</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2025/" rel="tag">2025</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bug%E6%80%BB%E7%BB%93/" rel="tag">Bug总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CVPR/" rel="tag">CVPR</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CVPR-Workshop/" rel="tag">CVPR Workshop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICCV/" rel="tag">ICCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICLR/" rel="tag">ICLR</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICML/" rel="tag">ICML</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IJCAI/" rel="tag">IJCAI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Knife4j/" rel="tag">Knife4j</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MinIO/" rel="tag">MinIO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis-Plus/" rel="tag">Mybatis-Plus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NeurIPS/" rel="tag">NeurIPS</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ODE%E6%B1%82%E8%A7%A3/" rel="tag">ODE求解</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RocketMQ/" rel="tag">RocketMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diffusion/" rel="tag">diffusion</a><span class="tag-list-count">52</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/latex/" rel="tag">latex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" rel="tag">代码随想录</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%B4%E5%87%BD%E6%95%B0/" rel="tag">头函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%9A%E5%BA%AD%E5%85%AC%E5%AF%93/" rel="tag">尚庭公寓</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" rel="tag">异常处理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" rel="tag">快速入门</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" rel="tag">技术总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E8%A7%A3/" rel="tag">注解</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%AB%99/" rel="tag">网站</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%A5%E4%BE%9D/" rel="tag">若依</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BA%E6%96%87/" rel="tag">论文</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8i/" rel="tag">链表i</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%85%E8%AF%BB/" rel="tag">阅读</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" rel="tag">项目实战</a><span class="tag-list-count">6</span></li></ul>
        </canvas>
    </div>
</div>



    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zongqing Li</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #4D4D4C;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #F7F7F7;
      background-image: linear-gradient(#F7F7F7, #F7F7F7);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>

  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('post.copy_button').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('post.copy_success')
          else $(this).text('post.copy_failure')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('post.copy_button')
        }, 300)
      }).append(e)
    })
  </script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":-15,"vOffset":-15},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
